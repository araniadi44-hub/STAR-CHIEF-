<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>STAR CHIEF</title>
    <style>
        /* ================================== */
        /* CSS UMUM & LATAR BELAKANG BINTANG */
        /* (Tidak diubah dari kode sebelumnya) */
        /* ================================== */
        body { 
            margin: 0; 
            height: 100vh; 
            width: 100vw; 
            background-color: #000; 
            overflow: hidden; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            color: white; 
            font-family: 'Arial', sans-serif; 
        }
        .stars-background { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
        }
        .star { 
            height: 2px; 
            width: 2px; 
            background: transparent; 
            position: absolute; 
            top: 0; 
            left: 0; 
            box-shadow: 20px 100px #fff, 150px 300px #fff, 300px 50px #fff, 450px 450px #fff, 600px 150px #fff, 750px 350px #fff, 900px 50px #fff, 50px 550px #fff, 250px 700px #fff, 400px 900px #fff, 700px 250px #fff, 950px 800px #fff, 100px 200px #eee, 350px 750px #eee, 500px 100px #eee, 800px 600px #eee, 40px 650px 1px 1px #fff, 650px 50px 1px 1px #fff; 
        }
        .game-title { 
            position: relative; 
            z-index: 10; 
            text-align: center; 
        }
        .super { 
            font-size: 5em; 
            background: linear-gradient(90deg, #ff9900 0%, #ff9900 20%, #ffff00 20%, #ffff00 40%, #00ff00 40%, #00ff00 60%, #0000ff 60%, #0000ff 80%, #ff0000 80%, #ff0000 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            font-weight: bold; 
        }
        .space-invaders { 
            font-family: 'Times New Roman', serif; 
            font-size: 3.5em; 
            color: #ff0000; 
            text-shadow: 0 0 10px #ff0000, 0 0 5px #ff4444; 
            font-weight: 900; 
            margin-top: -30px; 
        }
        .button-group { 
            margin-top: 40px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 50px; 
        }
        .icon-button { 
            width: 80px; 
            height: 80px; 
            background-color: #ff6600; 
            border-radius: 15px; 
            box-shadow: 0 0 10px rgba(255, 102, 0, 0.6); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            color: white; 
            font-size: 2em; 
            cursor: pointer; 
            transition: transform 0.2s; 
        }
        .corner-button { 
            position: absolute; 
            z-index: 20; 
            width: 60px; 
            height: 60px; 
            background-color: #ff6600; 
            border-radius: 10px; 
            box-shadow: 0 0 8px rgba(255, 102, 0, 0.6); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            font-size: 1.5em; 
            text-decoration: none; 
            color: white;
        }
        .corner-button.logo { 
            top: 20px; 
            left: 20px; 
            color: yellow; 
        }
        .corner-button.lang { 
            top: 20px; 
            right: 20px; 
        }
        .play-button { 
            display: inline-block; 
            width: 120px; 
            height: 120px; 
            background-color: #ff6600; 
            border-radius: 25px; 
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.8), 0 5px 15px rgba(0, 0, 0, 0.5); 
            transition: transform 0.2s, box-shadow 0.2s; 
            cursor: pointer; 
            position: relative; 
            text-decoration: none; 
        }
        .play-button:hover, .icon-button:hover { 
            transform: scale(1.05); 
            box-shadow: 0 0 30px rgba(255, 102, 0, 1), 0 8px 20px rgba(0, 0, 0, 0.6); 
        }
        .play-icon { 
            position: absolute; 
            top: 50%; 
            left: 55%; 
            transform: translate(-50%, -50%); 
            width: 0; 
            height: 0; 
            border-top: 25px solid transparent; 
            border-bottom: 25px solid transparent; 
            border-left: 45px solid white; 
        }
        .footer-link { 
            position: absolute; 
            bottom: 20px; 
            z-index: 10; 
            text-decoration: none; 
            padding: 8px 15px; 
            border-radius: 5px; 
            font-weight: bold; 
            font-size: 0.9em; 
            transition: background-color 0.3s; 
        }
        .share-button { 
            right: 150px; 
            background-color: #28a745; 
            color: white; 
        }
        .share-button:hover { 
            background-color: #1e7e34; 
        }
        .privacy-button { 
            right: 20px; 
            background-color: #555; 
            color: white; 
        }
        .privacy-button:hover { 
            background-color: #333; 
        }

        /* ================================== */
        /* CSS KHUSUS LOADING & LAYAR */
        /* ================================== */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
        }
        .spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid #ff6600;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            color: white;
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            /* Pastikan kontainer mengambil ruang yang cukup */
            width: 100%;
            height: 100%;
        }

        #gameCanvas {
            border: 2px solid #fff;
            background-color: #000;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            /* Hapus margin-bottom agar tombol pas */
            /* margin-bottom: 50px; */ 
            
            /* BARU: Buat canvas responsif */
            max-width: 100%;
            max-height: 80vh; /* Batasi tinggi di HP */
            object-fit: contain;
        }
        
        #controls {
            /* BARU: Sembunyikan teks kontrol keyboard */
            display: none;
        }

        /* ================================== */
        /* CSS KONTROL MOBILE (BARU) */
        /* ================================== */
        #mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box; /* Agar padding tidak merusak lebar */
            z-index: 100;
        }

        #mobile-controls button {
            width: 80px;
            height: 80px;
            background-color: rgba(255, 102, 0, 0.7); /* Semi-transparan */
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%; /* Bulat */
            color: white;
            font-size: 2.5em;
            cursor: pointer;
            
            /* Mencegah perilaku aneh di HP */
            user-select: none; 
            -webkit-user-select: none; /* Safari */
            -webkit-tap-highlight-color: transparent; /* Hapus highlight biru saat disentuh */
        }
        
        /* Buat tombol tembak lebih besar di tengah */
        #btn-shoot {
            width: 90px;
            height: 90px;
            font-size: 3em;
        }

    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">MEMUAT GAME... SIAPKAN ROKET ANDA!</div>
    </div>

    <div class="stars-background">
        <div class="star"></div>
    </div>
    
    <a href="#" class="corner-button logo" onclick="showScreen('menu'); return false;">üïπÔ∏è</a>
    <a href="#" class="corner-button lang">üá¨üáß</a>

    <div id="menu-screen">
        <div class="game-title">
            <div class="super">STAR</div>
            <div class="space-invaders">CHIEF</div>
    
            <div class="button-group">
                <div class="icon-button">üöÄ</div>
    
                <a href="#" id="playButton" class="play-button" title="Mulai Permainan">
                    <div class="play-icon"></div>
                </a>
                
                <div class="icon-button">‚öôÔ∏è</div>
            </div>
        </div>
    
        <a href="URL_SHARE_GAME" class="footer-link share-button" target="_blank">
            Bagikan Game üì¢
        </a>
        
        <a href="URL_PRIVACY_POLICY" class="footer-link privacy-button" target="_blank">
            Privacy
        </a>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="600" height="400"></canvas>
        <div id="controls">
            Kontrol: ‚¨ÖÔ∏è Kiri | ‚û°Ô∏è Kanan | SPACE Tembak
        </div>
        
        <div id="mobile-controls">
            <button id="btn-left">‚¨ÖÔ∏è</button>
            <button id="btn-shoot">üöÄ</button>
            <button id="btn-right">‚û°Ô∏è</button>
        </div>
    </div>


    <script>
        // Mendapatkan elemen DOM
        const menuScreen = document.getElementById('menu-screen');
        const gameContainer = document.getElementById('game-container');
        const loadingOverlay = document.getElementById('loading-overlay');
        const playButton = document.getElementById('playButton');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // === ELEMEN DOM BARU UNTUK KONTROL MOBILE ===
        const btnLeft = document.getElementById('btn-left');
        const btnRight = document.getElementById('btn-right');
        const btnShoot = document.getElementById('btn-shoot');

        let gameLoopId = null; 
        
        // Fungsi untuk mengelola tampilan layar
        function showScreen(screen) {
            if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
                gameLoopId = null;
            }
            
            menuScreen.style.display = screen === 'menu' ? 'flex' : 'none';
            gameContainer.style.display = screen === 'game' ? 'flex' : 'none';
        }

        // ==================================
        // LOGIKA PERMAINAN
        // ==================================

        // Konstanta Game
        // BARU: Sesuaikan ukuran canvas agar pas di layar HP
        // Kita set di CSS, tapi kita juga perlu JS untuk menyesuaikan skala jika perlu
        // Untuk sekarang, kita biarkan width/height asli untuk logika, 
        // dan biarkan CSS yang melakukan scaling.
        const GAME_WIDTH = canvas.width;
        const GAME_HEIGHT = canvas.height;
        const PLAYER_SIZE = 20;
        const ENEMY_SIZE = 15;
        const BULLET_SIZE = 5;
        const PLAYER_SPEED = 5;

        // Variabel Status Game
        let score = 0;
        let gameOver = false;
        let gameWin = false;
        let player = null;
        let enemies = [];
        let bullets = [];

        // Kelas Pemain (Kapal) - PESAWAT BARU
        class Player {
            constructor() {
                this.width = PLAYER_SIZE * 3; 
                this.height = PLAYER_SIZE * 2;
                this.x = GAME_WIDTH / 2 - this.width / 2;
                this.y = GAME_HEIGHT - this.height - 10;
                this.speedX = 0;
            }

            draw() {
                const pX = this.x;
                const pY = this.y;
                const w = this.width;
                const h = this.height;

                const unit = w / 8; 

                // 1. Badan Utama (Abu-abu Tua)
                ctx.fillStyle = '#666666'; 
                ctx.fillRect(pX + unit * 1, pY + unit * 1, unit * 6, h - unit * 1);

                // 2. Moncong / Ujung Depan (Merah)
                ctx.fillStyle = '#FF0000';
                ctx.beginPath();
                ctx.moveTo(pX + w / 2, pY);
                ctx.lineTo(pX + w / 2 - unit * 1, pY + unit * 1.5);
                ctx.lineTo(pX + w / 2 + unit * 1, pY + unit * 1.5);
                ctx.closePath();
                ctx.fill();

                // 3. Sayap Kiri dan Kanan (Abu-abu Muda)
                ctx.fillStyle = '#AAAAAA'; 
                ctx.fillRect(pX, pY + h * 0.7, unit * 2, unit * 0.5); 
                ctx.fillRect(pX + w - unit * 2, pY + h * 0.7, unit * 2, unit * 0.5);

                // 4. Kaca Kokpit (Biru Muda)
                ctx.fillStyle = '#ADD8E6';
                ctx.fillRect(pX + w / 2 - unit * 1, pY + unit * 2, unit * 2, unit * 1);

                // 5. Mesin/Pendorong (Oranye)
                ctx.fillStyle = '#FF6600';
                ctx.fillRect(pX + unit * 2, pY + h - unit * 0.5, unit * 1, unit * 0.5);
                ctx.fillRect(pX + unit * 5, pY + h - unit * 0.5, unit * 1, unit * 0.5);
            }

            update() {
                this.x += this.speedX;
                if (this.x < 0) this.x = 0;
                if (this.x > GAME_WIDTH - this.width) this.x = GAME_WIDTH - this.width;
            }
        }

        // Kelas Musuh (Invader) - TROLLFACE BARU
        class Enemy {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = ENEMY_SIZE * 2; // Perbesar sedikit agar detail terlihat
                this.height = ENEMY_SIZE * 2;
                this.color = 'white'; // Warna dasar putih
                this.speed = 1;
                this.moveDir = 1;
            }
            
            draw() {
                const eX = this.x;
                const eY = this.y;
                const w = this.width;
                const h = this.height;
                const unit = w / 4; // Skala pembagian

                // 1. Bentuk Wajah Dasar (Oval/Bulat) - Menggunakan fillStyle putih
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.ellipse(eX + w / 2, eY + h / 2, w / 2, h / 2 * 0.9, 0, 0, Math.PI * 2);
                ctx.fill();

                // 2. Garis Luar (Hitam)
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 1;
                ctx.stroke();

                // 3. Senyum Lebar (Hitam)
                ctx.fillStyle = '#000000';
                ctx.beginPath();
                ctx.arc(eX + w / 2, eY + h * 0.7, w * 0.35, 0, Math.PI, false); // Garis luar senyum
                ctx.fill();
                
                // 4. Mulut Bagian Dalam (Putih/Abu-abu Muda) - Untuk membuat gigi
                ctx.fillStyle = '#DEDEDE';
                ctx.beginPath();
                ctx.arc(eX + w / 2, eY + h * 0.7, w * 0.3, 0, Math.PI, false); 
                ctx.fill();

                // 5. Mata (Hitam - berbentuk kotak sederhana)
                ctx.fillStyle = '#000000';
                // Mata Kiri
                ctx.fillRect(eX + unit, eY + unit * 1.5, unit * 0.5, unit * 0.5);
                // Mata Kanan
                ctx.fillRect(eX + w - unit * 1.5, eY + unit * 1.5, unit * 0.5, unit * 0.5);
                
                // 6. Alis (Hitam - garis)
                ctx.beginPath();
                ctx.moveTo(eX + unit * 0.8, eY + unit);
                ctx.lineTo(eX + unit * 1.8, eY + unit);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(eX + w - unit * 1.8, eY + unit);
                ctx.lineTo(eX + w - unit * 0.8, eY + unit);
                ctx.stroke();

                // 7. Hidung (Titik hitam)
                ctx.fillRect(eX + w / 2 - 1, eY + h / 2 - 2, 2, 2);
            }

            update() {
                this.x += this.speed * this.moveDir;
            }
        }

        // Kelas Peluru
        class Bullet {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = BULLET_SIZE;
                this.width = 2;
                this.height = this.size;
                this.speed = 7;
                this.color = 'yellow';
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
            update() {
                this.y -= this.speed;
            }
        }

        // FUNGSI DETEKSI TABRAKAN
        function checkCollision(objA, objB) {
            return (
                objA.x < objB.x + objB.width &&
                objA.x + objA.width > objB.x &&
                objA.y < objB.y + objB.height &&
                objA.y + objA.height > objB.y
            );
        }

        // Inisialisasi Game
        function initGame() {
            score = 0;
            gameOver = false;
            gameWin = false;
            player = new Player();
            enemies = [];
            bullets = [];
            
            const rowCount = 3;
            const colCount = 10;
            const spacing = 40;
            const startX = 50;
            const startY = 30;

            for (let r = 0; r < rowCount; r++) {
                for (let c = 0; c < colCount; c++) {
                    // Penyesuaian posisi agar Trollface tidak terlalu berdekatan
                    const x = startX + c * spacing;
                    const y = startY + r * 40; 
                    enemies.push(new Enemy(x, y));
                }
            }
        }

        // Fungsi Utama Game Loop
        function gameLoop() {
            if (gameOver) {
                ctx.fillStyle = 'red';
                ctx.font = '40px Arial';
                ctx.fillText("GAME OVER!", GAME_WIDTH / 2 - 100, GAME_HEIGHT / 2);
                return;
            }
            if (gameWin) {
                ctx.fillStyle = 'lime';
                ctx.font = '30px Arial';
                ctx.fillText("LEVEL BERSIH! MENANG!", GAME_WIDTH / 2 - 150, GAME_HEIGHT / 2);
                return;
            }

            // 1. Bersihkan Canvas
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            // 2. Update dan Gambar Pemain
            player.update();
            player.draw();

            // 3. Update, Gambar, dan Cek Tabrakan Peluru
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].update();
                bullets[i].draw();

                let hit = false;
                for (let j = enemies.length - 1; j >= 0; j--) {
                    if (checkCollision(bullets[i], enemies[j])) {
                        enemies.splice(j, 1);
                        bullets.splice(i, 1);
                        score += 10;
                        hit = true;
                        break;
                    }
                }

                if (!hit && bullets[i] && bullets[i].y < 0) {
                    bullets.splice(i, 1);
                }
            }

            // 4. Update dan Gambar Musuh
            let edgeReached = false;
            for (const enemy of enemies) {
                enemy.update();
                enemy.draw();

                if (enemy.y + enemy.height >= GAME_HEIGHT - player.height) {
                    gameOver = true;
                }

                if (enemy.x + enemy.width > GAME_WIDTH || enemy.x < 0) {
                    edgeReached = true;
                }
            }
            
            if (edgeReached) {
                for (const enemy of enemies) {
                    enemy.moveDir *= -1;
                    enemy.y += 10;
                }
            }
            
            // 5. Cek Kemenangan
            if (enemies.length === 0) {
                gameWin = true;
            }

            // 6. Tampilkan Skor
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.fillText(`Skor: ${score}`, 10, GAME_HEIGHT - 10);
            ctx.fillText(`Trollface Tersisa: ${enemies.length}`, GAME_WIDTH - 150, GAME_HEIGHT - 10);

            // Ulangi loop
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // ==================================
        // FUNGSI KONTROL PEMAIN (BARU)
        // ==================================
        
        // Fungsi ini dipanggil oleh keyboard dan sentuhan
        function playerShoot() {
            if (!player || gameOver || gameWin || gameContainer.style.display !== 'flex') return;
            const newBullet = new Bullet(player.x + player.width / 2 - 1, player.y);
            bullets.push(newBullet);
        }

        // Fungsi ini dipanggil oleh keyboard dan sentuhan
        function playerStopMove() {
            if (player) {
                player.speedX = 0;
            }
        }


        // ==================================
        // INPUT KEYBOARD (Sedikit dimodifikasi)
        // ==================================
        document.addEventListener('keydown', (e) => {
            if (!player || gameOver || gameWin || gameContainer.style.display !== 'flex') return;

            if (e.key === 'ArrowLeft' || e.key === 'a') {
                player.speedX = -PLAYER_SPEED;
            } else if (e.key === 'ArrowRight' || e.key === 'd') {
                player.speedX = PLAYER_SPEED;
            } else if ((e.key === ' ' || e.key === 'Spacebar')) {
                playerShoot(); // Menggunakan fungsi baru
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'ArrowRight' || e.key === 'd') {
                playerStopMove(); // Menggunakan fungsi baru
            }
        });

        // ==================================
        // INPUT SENTUH (MOBILE) (BARU)
        // ==================================

        // { passive: false } dan event.preventDefault() 
        // sangat penting untuk mencegah layar HP
        // melakukan zoom atau scroll saat tombol disentuh.

        // Tombol Kiri
        btnLeft.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (player) player.speedX = -PLAYER_SPEED;
        }, { passive: false });

        btnLeft.addEventListener('touchend', (e) => {
            e.preventDefault();
            playerStopMove();
        }, { passive: false });

        // Tombol Kanan
        btnRight.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (player) player.speedX = PLAYER_SPEED;
        }, { passive: false });

        btnRight.addEventListener('touchend', (e) => {
            e.preventDefault();
            playerStopMove();
        }, { passive: false });

        // Tombol Tembak
        btnShoot.addEventListener('touchstart', (e) => {
            e.preventDefault();
            playerShoot();
        }, { passive: false });


        // ==================================
        // LOGIKA ALIRAN APLIKASI
        // ==================================

        // Atur Tampilan Awal ke Menu
        showScreen('menu');

        // Tambahkan Event Listener ke Tombol Play
        playButton.addEventListener('click', function(event) {
            event.preventDefault();
            
            loadingOverlay.style.display = 'flex';
            
            // Mulai simulasi loading (3 detik)
            setTimeout(function() {
                loadingOverlay.style.display = 'none';
                
                // Pindah ke layar game dan mulai game loop
                showScreen('game');
                initGame();
                gameLoop();
                
            }, 3000); 
        });

    </script>
</body>
</html>
